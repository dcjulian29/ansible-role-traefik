---
http:
  routers:
    traefik:
      entrypoints: [{{ traefik_https | ternary('websecure', 'web') }}]
      rule: {% if traefik_dashboard_fqdn | length > 0 %}"Host(`{{ traefik_dashboard_fqdn }}`)"
            {% else %}"PathPrefix(`/api`) || PathPrefix(`/dashboard`)"
            {% endif %}
      service: api@internal
      middlewares: {{ traefik_dashboard_middlewares | list }}

  middlewares:
    dashboard-auth-basic:
      basicAuth:
        headerField: X-WebAuth-User
        users:
          - "{{ traefik_dashboard_user }}:{{ traefik_dashboard_pass | password_hash('bcrypt', traefik_salt) }}"

    dashboard-rate-limit:
      rateLimit:
        average: 100
        burst: 50

    dashboard-secure-headers:
      headers:
        accessControlAllowMethods:
          - GET
          - OPTIONS
          - POST
          - PUT
        accessControlMaxAge: 100
        addVaryHeader: true
        hostsProxyHeaders:
          - "X-Forwarded-Host"
        contentSecurityPolicy: "frame-ancestors 'self';"
        customResponseHeaders:
          X-Robots-Tag: "none,noarchive,nosnippet,notranslate,noimageindex,noindex"
          server: ""
